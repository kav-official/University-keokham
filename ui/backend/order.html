<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ @SITE_NAME }}</title>
    <include href="backend/inc/header.html" />
</head>
<body class="md-skin">
    <div id="wrapper">
    <include href="backend/inc/nav.html" />
        <div id="page-wrapper" class="gray-bg">
        <div class="row border-bottom">
          <include href="backend/inc/topnav.html" />
        </div>
        <div class="row wrapper border-bottom white-bg page-heading">
            <div class="col-lg-10 la">
                <h2>{{ @strPage }}</h2>
                <ol class="breadcrumb">
                    <li class="breadcrumb-item">
                        <a href="/">Dashboard</a>
                    </li>
                    <li class="breadcrumb-item active la">
                        <strong>ກວດຊອບສິນຄ້າ</strong>
                    </li>
                </ol>
            </div>
            <div class="col-lg-2">
            </div>
        </div>
        <div class="wrapper wrapper-content">
          <div class="ibox float-e-margins" id="app">
            <div class="ibox-title la" style="display: flex;justify-content: space-between;">
                <h5><strong>ກວດຊອບສິນຄ້າ</strong></h5>
                <a href="{{@BASE}}/order"><h5><strong>ປະຫວັດການສັ່ງຊື້</strong></h5></a>
            </div>
            <div class="ibox-content">            
                <div class="form-group">
                    <label class="col-sm-1 control-label la">ບາໂຄດ</label>
                        <div class="col-sm-2" style="display: flex;">
                            <input name="barcode" type="text" ref="onFocus"v-on:keyup.enter="getData" class="form-control">
                        </div>

                    <label class="col-sm-1 control-label"></label>
                    <div class="table-responsive">
                        <table class="table table-striped table-bordered table-hover datatables-content">
                        <thead>
                            <tr>
                            <th class="la">ຮູບສິນຄ້າ</th>
                            <th class="la">ລະຫັດສິນຄ້າ</th>
                            <th class="la">ຊື່ສິນຄ້າ</th>
                            <th class="la">ຈຳນວນ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <template  v-for="(item,index) in items">
                                <tr>
                                    <td>
                                        <img :src="item.image" width="120" alt="item.name">
                                    </td> 
                                    <td>{-{{ item.product_no }}-}</td> 
                                    <td>{-{{ item.name }}-}</td> 
                                    <td>
                                    <input type="text" :value="item.qty" @keyup.enter="updateQTY(item.product_no)" class="form-control">
                                    </td> 
                                </tr>
                            </template>
                        </tbody>
                        </table>
                    </div>
                </div>
                <div class="form-group text-center">
                <button class="btn btn-info la" v-on:click="updateBill" v-if="viSible">ບັນທຶກການສັ່ງຊື້ <i class="fa fa-save"></i></button>
                </div>
                <div class="form-group">
                    <div id="DivIdToPrint">
                        <div class="table-responsive">
                            <div class="header-bill text-center la" id="viSible_bill_header">
                                <div align="center" ><img src="{{@BASE}}/uploads/logo.png" width="100" style="font-family: Noto Sans Lao;" /></div>
                                <h3 align="center" style="font-family: Noto Sans Lao;"><strong>ໃບແຈັງບິນສັ່ງຊື້</strong></h3>
                                <h5 align="center" style="font-family: Noto Sans Lao;">ຮ້ານຂາຍເກີບຂອງຮ້ານ 35</h5>
                            </div>

                            <table class="table table-striped table-bordered table-hover datatables-content text-center">
                            <thead>
                                <tr>
                                <th class="la">ລຳດັບ</th>
                                <th class="la">ລະຫັດສິນຄ້າ</th>
                                <th class="la">ຊື່ສິນຄ້າ</th>
                                <th class="la">ຈຳນວນ</th>
                                <th class="la">ຈັດການ</th>
                                </tr>
                            </thead>
                            <tbody>
                                <template  v-for="(item,index) in tableData">
                                    <tr>
                                        <td>{-{{ index+1 }}-}</td> 
                                        <td>{-{{ item.product_no }}-}</td> 
                                        <td>{-{{ item.name }}-}</td> 
                                        <td>{-{{ item.qty }}-}</td> 
                                        <td>
                                            <button type="button" itemid="item.product_no" class="btn btn-danger" v-on:click="deleteOrder(index,item.product_no)"> <i class="fa fa-trash"></i></button>
                                        </td> 
                                    </tr>
                                </template>
                            </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
 <include href="backend/inc/footer.html" />
</div>
<include href="backend/inc/script.html" />    
<script type="text/javascript">
    new Vue({
        el:'#app',
        data:{
            filter:'',
            items:[],
            tableData:'',
            viSible:true,
            order_no:'',
        },
        mounted(){
            this.onFocus();
        },
        methods:{
            onFocus:function() {
                this.$refs.onFocus.focus();
            },

            getData:function(){
                axios.post('{{ @BASE }}/order/data/'+event.target.value)
                .then((res)=>{
                    var data = res.data;
                    if(data.success){
                        this.items = data.data;
                    }else{
                        alert('fail response data');
                    }
                })
            },
            updateQTY:function(product_no){
                const qty = event.target.value;
                    axios.post('{{ @BASE }}/order/update/'+product_no+'/'+qty)
                    .then((res)=>{
                        var data = res.data;
                        if(data.success){
                            this.tableData = data.data;
                        }else{
                            alert('fail response data');
                        }
                    })
                },
            updateBill:function(){
                axios.post('{{ @BASE }}/order/update/bill')
                .then((res)=>{
                    var data = res.data;
                    if(data.success){
                        this.tableData = [];
                        this.filter='';
                        Swal.fire('ບັນທຶກການສັ່ງຊື້ສຳເລັດ',data.message,'success');
                    }else{
                        alert('fail response data');
                    }
                })
            },
            deleteOrder:function(index,product_no){
                // var obj = $(this);
                axios.delete('{{ @BASE }}/order/delete/'+product_no)
                .then((res)=>{
                    var data = res.data;
                    if(data.success == true){
                         this.tableData.splice(index,1);
                        Swal.fire('Completed',data.message,'success');
                    }else{
                        alert('fail response data');
                    }
                })
            }
        }
    })
</script>
 <script type="text/javascript">
        $(document).ready(function(){
            $("#viSible_bill_header").hide();
        });
        function show_bill_header(){
            $("#viSible_bill_header").show();
        }
        function printDiv() 
          {
    
            var data=document.getElementById("DivIdToPrint").innerHTML;
            var myWindow = window.open('', 'Bill','');
            myWindow.document.write('<html><head><title>Bill</title>');
            var htmlHeader = '' + '<style type="text/css">' 
              + 'table {' + 'font-family: "Phetsarath OT"; margin-top:7px;font-size:12px; border:1' 
              +'}#header{border-collapse: collapse;width: 100%;}#header td, #header th {padding: 0px 3px 0px 3px;}#header th { padding-top: 12px;padding-bottom: 12px;text-align: left;}</style>';
            var htmlContent = '' + '<style type="text/css">' 
              + 'table {' + 'font-family: "Phetsarath OT"; margin-top:7px;font-size:12px' 
              +'}#content{border-collapse: collapse;width: 100%;}#content td, #content th {padding: 0px 3px 0px 3px;}#content th { padding-top: 12px;padding-bottom: 12px;text-align: left;}</style>';
            var htmlTable = '' + '<style type="text/css">' 
              + 'table {' + 'font-family: "Phetsarath OT"; margin-top:7px;font-size:12px' 
              +'}#table{border-collapse: collapse;width: 100%;}#table td, #table th {border: 1px solid #ddd;padding: 0px 3px 0px 3px;}#table th { padding-top: 12px;padding-bottom: 12px;text-align: left;}</style>';
            myWindow.document.write('</head><body>');
            myWindow.document.write(data);
            myWindow.document.write('</body></html>');
            myWindow.document.write(htmlHeader);
            myWindow.document.write(htmlContent);
            myWindow.document.write(htmlTable);
            myWindow.document.close();

            myWindow.onload=function(){
                myWindow.focus();
                myWindow.print();
            };

          }
  </script>
</body>
</html>

